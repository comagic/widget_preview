<div class="comagic-widget comagic-offline-message-generator-background comagic-offline-message-generator-background--<%= v_position %>--<%= h_position %> comagic-offline-message-generator-background--shown">
    <div class="comagic-offline-message-generator__wrap">
    <div class="comagic-offline-message-generator__background-submit-popup comagic-offline-message-generator__background-submit-popup--<%= v_position %>">
        <div class="comagic-offline-message-generator__submit-popup comagic-offline-message-generator__submit-popup--<%= h_position %> comagic-offline-message-generator__submit-popup--hidden">
            <div class="comagic-offline-message-generator__submit-popup__title"></div>
            <div class="comagic-offline-message-generator__submit-popup__message"></div>
        </div>
    </div>
    <div class="comagic-offline-message-generator <%= is_image ? 'comagic-offline-message-generator--with-image' : '' %> comagic-offline-message-generator--<%= v_position %>--<%= h_position %>">
        <div class="comagic-offline-message-generator__inner <%= is_image ? 'comagic-offline-message-generator--with-image__inner' : '' %>">
            <% if (is_image) { %>
            <div class="comagic-offline-message-generator__image" style="background-image: url(<%= image_url %>);"></div>
            <% } %>
            <div class="comagic-offline-message-generator__close-btn">&times;</div>
            <div class="comagic-offline-message-generator__message"><%= message %></div>

            <% fields.forEach(function(field) {
            if (field.name === 'name') { %>
            <div class="comagic-offline-message-generator__field">
                <input c-name="name" c-type="field" c-validator="<%= field['is_required'] ? 'required' : '' %>"
                       class="comagic-offline-message-generator__field__input"
                       placeholder="<%= field['title'] %><%= field['is_required'] ? '*' : '' %>">
            </div>
            <%}
            if (field.name === 'phone') { %>
            <div class="comagic-offline-message-generator__field">
                <input c-mask="+7 (___) ___-__-__" c-name="phone" c-type="numberfield"
                       c-validator="phone <%= field['is_required'] ? 'required' : '' %>"
                       class="comagic-offline-message-generator__field__input"
                       placeholder="<%= field['title'] %><%= field['is_required'] ? '*' : '' %>">
            </div>
            <%}
            if (field.name === 'email') {%>
            <div class="comagic-offline-message-generator__field">
                <input c-name="email" c-type="field"
                       c-validator="email <%= field['is_required'] ? 'required' : '' %>"
                       class="comagic-offline-message-generator__field__input"
                       placeholder="<%= field['title'] %><%= field['is_required'] ? '*' : '' %>">
            </div>
            <%}
            if (field.name === 'message') {%>
            <div class="comagic-offline-message-generator__field comagic-offline-message-generator__field-textarea">
                <div contenteditable="true" c-name="message" c-type="field"
                     c-validator="<%= field['is_required'] ? 'required' : '' %>"
                     class="comagic-offline-message-generator__field__input comagic-offline-message-generator__field-textarea__input"
                     placeholder="<%= field['title'] %><%= field['is_required'] ? '*' : '' %>"></div>
            </div>
            <%}
            if (field.name === 'custom') {%>
            <div class="comagic-offline-message-generator__field">
                <input c-name="custom" c-type="field"
                       c-validator="<%= field['is_required'] ? 'required' : '' %>"
                       class="comagic-offline-message-generator__field__input"
                       placeholder="<%= field['title'] %><%= field['is_required'] ? '*' : '' %>">
            </div>
            <%}
            })%>

            <% if (is_groups_enabled) { %>
            <div class="comagic-offline-message-generator__field comagic-offline-message-generator__field-group">
                <input tabindex="-1" unselectable="on" c-name="group" c-type="field" c-validator="required" class="comagic-offline-message-generator__field__input comagic-offline-message-generator__field-group__input" readonly="readonly" placeholder="<%= group_title %>*">
                <select tabindex="-1" unselectable="on" class="comagic-offline-message-generator__field-group__select">
                    <% allowed_groups.forEach(function(group) { %>
                    <option value="<%= group.id %>" class="comagic-offline-message-generator__field-group__option"><%= group.name %></option>
                    <% }); %>
                </select>
            </div>
            <% } %>

            <% if(is_personal_info_enabled) { %>
                <div class="comagic-offline-message-generator__field comagic-offline-message-generator__field-personal-info">
                    <input type="checkbox"
                           c-name="personal_info"
                           c-type="checkbox"
                           c-validator="required"
                           checked="checked"
                           class="comagic-offline-message-generator__field__input comagic-offline-message-generator__field__input--personal-info">
                    <label class="comagic-offline-message-generator__field__label comagic-offline-message-generator__field__label--personal-info"><%= personal_info_text %></label>
                </div>
            <% } %>

            <div class="comagic-offline-message-generator__main-btn-area">
                <a tabindex="0" unselectable="on"
                   class="comagic-offline-message-generator__main-btn comagic-unselectable"
                   style="background-color: #<%= button_color %>;">
                    <span style="color: #<%= Comagic.UI.getContrastColor(button_color) %>;"
                          class="comagic-offline-message-generator__main-btn__inner">Отправить</span>
                </a>
            </div>

            <div class="comagic-offline-message-generator__bottom-bar">
                <% if (widget_link_url && widget_link_text) { %>
                <a href="<%= widget_link_url %>" target="_blank" class="comagic-offline-message-generator__bottom-bar__link comagic-offline-message-generator__widget-link"><%= widget_link_text %></a>
                <% } %>

                <% if (banner_branding_url && banner_branding_text) { %>
                <a href="<%= banner_branding_url %>" target="_blank" class="comagic-offline-message-generator__bottom-bar__link comagic-offline-message-generator__branding"><%= banner_branding_text %></a>
                <% } %>
            </div>
        </div>
    </div>
    </div>
</div>